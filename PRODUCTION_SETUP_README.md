# ðŸš€ AI Promote - Production Setup

Quick guide to deploy AI Promote to production with Supabase, Upstash Redis, and Vercel.

## Quick Start

Run the master setup script to configure everything automatically:

```bash
# Make scripts executable (Linux/macOS/WSL)
chmod +x setup-production.sh
chmod +x scripts/*.sh

# Run full production setup
./setup-production.sh
```

For Windows Command Prompt:
```cmd
bash setup-production.sh
```

## What This Sets Up

1. **Database**: PostgreSQL on Supabase with connection pooling
2. **Redis**: Upstash Redis for caching, sessions, rate limiting, and job queues
3. **Deployment**: Vercel hosting with automatic scaling
4. **Security**: Generated secrets and secure configuration
5. **Monitoring**: Health check endpoints and logging
6. **Performance**: Caching strategies and queue system

## Prerequisites

Before running the setup:

- Node.js 18+ installed
- npm installed
- Git installed
- Vercel account (free tier available)
- Supabase account (free tier available)
- Upstash account (free tier available)

## Step-by-Step Options

If you prefer manual control, run individual steps:

```bash
# 1. Environment and secrets only
./setup-production.sh --env-only

# 2. Database setup only  
./setup-production.sh --db-only

# 3. Redis setup only
./setup-production.sh --redis-only

# 4. Deploy to Vercel only
./setup-production.sh --deploy-only

# 5. Verify deployment only
./setup-production.sh --verify-only
```

## Individual Scripts

You can also run the individual setup scripts:

```bash
# Database setup (Supabase)
bash scripts/setup-production-db.sh all

# Redis setup (Upstash)
bash scripts/setup-redis.sh all

# Deployment (Vercel)
bash scripts/deploy-production.sh all
```

## Required Environment Variables

You'll need to configure these in your `.env.production`:

```bash
# Database (from Supabase dashboard)
DATABASE_URL=postgresql://postgres:[PASSWORD]@db.[PROJECT_REF].supabase.co:5432/postgres?pgbouncer=true&connection_limit=1
SUPABASE_URL=https://[PROJECT_REF].supabase.co
SUPABASE_ANON_KEY=[YOUR_ANON_KEY]

# Redis (from Upstash console)
REDIS_URL=rediss://default:[PASSWORD]@[ENDPOINT]:6380

# AI Services
OPENAI_API_KEY=[YOUR_OPENAI_KEY]
ANTHROPIC_API_KEY=[YOUR_ANTHROPIC_KEY]

# Security (generated by setup script)
JWT_SECRET=[GENERATED_SECRET]
NEXTAUTH_SECRET=[GENERATED_SECRET]
ENCRYPTION_KEY=[GENERATED_KEY]
```

## What Happens During Setup

1. **Prerequisites Check**: Verifies Node.js, npm, git, and installs Vercel CLI
2. **Environment Setup**: Creates `.env.production` from template
3. **Secret Generation**: Creates secure random secrets using OpenSSL
4. **Database Setup**: 
   - Guides you through Supabase project creation
   - Runs Prisma migrations
   - Sets up connection pooling
5. **Redis Setup**:
   - Guides you through Upstash Redis creation
   - Creates caching utilities
   - Sets up rate limiting and job queues
6. **Deployment**:
   - Builds and deploys to Vercel
   - Sets environment variables
   - Configures health check endpoints
7. **Verification**: Tests deployment and health endpoints

## After Deployment

Your app will be available at: `https://your-project.vercel.app`

Health check endpoints:
- `/api/health` - Overall system health
- `/api/health/database` - Database connection
- `/api/health/redis` - Redis connection  
- `/api/health/queues` - Job queue status

## Monitoring & Management

- **Vercel Dashboard**: https://vercel.com/dashboard
- **Supabase Dashboard**: https://app.supabase.com
- **Upstash Console**: https://console.upstash.com

Useful commands:
```bash
vercel logs          # View application logs
vercel env ls        # List environment variables
vercel rollback      # Rollback to previous deployment
```

## Troubleshooting

### Common Issues

1. **Build Errors**: Check that all environment variables are set correctly
2. **Database Connection**: Verify DATABASE_URL format and credentials
3. **Redis Connection**: Ensure REDIS_URL uses `rediss://` (with SSL)
4. **Missing Secrets**: Run `./setup-production.sh --env-only` to regenerate

### Getting Help

1. Check setup logs: `setup-YYYYMMDD_HHMMSS.log`
2. Verify health endpoints work: `curl https://your-app.vercel.app/api/health`
3. Review individual service dashboards for errors
4. Check Vercel function logs for runtime errors

## Security Reminders

- âœ… Never commit `.env.production` to git
- âœ… Delete `generated-secrets.txt` after copying secrets
- âœ… Rotate secrets quarterly  
- âœ… Monitor access logs regularly
- âœ… Keep dependencies updated

## Cost Optimization

Free tiers available:
- **Vercel**: Generous free tier for personal projects
- **Supabase**: 500MB database, 50MB file storage
- **Upstash**: 10,000 Redis commands/day
- **AWS S3**: 5GB storage (if using S3)

Monitor usage in each service dashboard and set up billing alerts.

---

For detailed documentation, see [docs/PRODUCTION_SETUP.md](docs/PRODUCTION_SETUP.md).
